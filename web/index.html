<title>Monkey Type Clone - Test your typing skills!</title>
<style>
    :root{
        color-scheme: light dark;
        --green: #00b755;
        --yellow: #daaf38;
        --red: #ca4754;
        --black: #222;
        --gray: #999;
    }

    header{
        font-family: "Myriad Pro", monospace;
        padding-bottom: 32px;
        display: grid;
        place-content: center;
    }

    body{
        background-color: var(--black);
        font-family: Menlo, monospace;
        display: grid;
        place-content: center;
        padding: 32px;
    }

    section{
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 4px;
        max-width: 500px;
    }

    time{
        color: var(--yellow)
    }

    input{
        z-index: -999;
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
        /* opacity: 0; */
    }

    p{
        display: flex;
        flex-wrap: wrap;
        gap: 3px 8px;
        margin: 0;
    }

    x-letter{
        color: var(--gray);
        position: relative;

        &.active::before{
            content: '|';
            color: var(--yellow);
            font-size: 14px;
            position: absolute;
            left: -65%;
            animation: 1s blink infinite ease-in-out;
        }

        &.true{
            color: var(--green)
        }

        &.false{
            color: var(--red)
        }
    }

    @keyframes blink {
        0%, 25% {
            opacity: 1;
        }

        75% {
            opacity: 0;
        }
    }

</style>

<body>
    <header>
        Monkey Type's Clone
    </header>
    <main>
        <section id="game">
            <time></time>
            <p></p>
            <input autofocus>
        </section>
    </main>
</body>

<script>
    const $time = document.querySelector('time');
    const $paragraph = document.querySelector('p');
    const $input = document.querySelector('input');

    const INITIAL_TIME = 30;

    const TEXT = 'The quick brown fox jumps over the lazy dog and you are trying to clone monkey type for fun and profit using vanilla js for the typing test speed'

    let words = []
    let currentTime = INITIAL_TIME

    initGame()
    initEvents()

    function initGame()
    {
        words = TEXT.split(' ').slice(0, 32)
        currentTime = INITIAL_TIME

        $time.textContent = currentTime

        $paragraph.innerHTML = words.map((word, index) => {
            const letters = word.split('')

            return `<x-word>
                ${letters
                    .map(letter => `<x-letter>${letter}</x-letter>`)
                    .join('')
                }
            </x-word>
            `
        }).join('')

        const $firstWord = $paragraph.querySelector('x-word')
        $firstWord.classList.add('active')
        $firstWord.querySelector('x-letter').classList.add('active')

        const intervalId = setInterval(() => {
            currentTime--
            $time.textContent = currentTime

            if (currentTime == 0){
                clearInterval(intervalId)
                GameOver()
            }

        }, 1000)
    }

    function initEvents()
    {
        document.addEventListener('keydown', () => {
            $input.focus()
        })

        $input.addEventListener('keydown', onKeyDown)
        $input.addEventListener('keyup', onKeyUp)
    }
    
    function onKeyDown () {}
    
    function onKeyUp () {
        const $currentWord = $paragraph.querySelector('x-word.active')
        const $currentLetter = $currentWord.querySelector('x-letter.active')

        const currentWord = $currentWord.innerText.trim()
        $input.maxLength = currentWord.length
        console.log({value: $input.value, currentWord})

        const $allLetters = $currentWord.querySelectorAll('x-letter')

        $allLetters.forEach($letter => $letter.classList.remove('true', 'false'))

        $input.value.split('').forEach((char, index) => {
            const $letter = $allLetters[index]
            const letterToCheck = currentWord[index]

            const isCorrect = char == letterToCheck
            const letterClass = isCorrect ? 'true' : 'false'
            $letter.classList.add(letterClass)
        })
    }

    function GameOver ()
    {
        console.log('Game Over')
    }

</script>